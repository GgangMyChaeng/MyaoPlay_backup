================================================================================
MyaoPlay ì•„í‚¤í…ì²˜ ë¬¸ì„œ
================================================================================

[1] í´ë” êµ¬ì¡°
================================================================================

MyaoPlay/
â”œâ”€ index.js                 # ST í™•ì¥ ë©”ì¸ ì§„ì…ì  (manifest.jsonì—ì„œ ì§€ì •)
â”œâ”€ manifest.json
â”œâ”€ style.css
â”‚
â”œâ”€ templates/
â”‚   â”œâ”€ window.html          # ST í™•ì¥ ì„œë UI
â”‚   â”œâ”€ popup.html           # ì„¤ì • ëª¨ë‹¬ HTML
â”‚   â””â”€ freesources.html     # Free Sources ëª¨ë‹¬ HTML
â”‚
â”œâ”€ vendor/
â”‚   â””â”€ jszip.min.js
â”‚
â”œâ”€ data/
â”‚   â””â”€ freesources.json     # Free Sources ë°ì´í„°
â”‚
â”œâ”€ docs/
â”‚   â””â”€ ARCHITECTURE.txt     # ì´ ë¬¸ì„œ
â”‚
â””â”€ modules/
    â”œâ”€ [ì½”ì–´ ëª¨ë“ˆ]
    â”‚   â”œâ”€ deps.js          # ST ì˜ì¡´ì„± ë¡œë” (extension_settings, saveSettingsDebounced)
    â”‚   â”œâ”€ settings.js      # ì„¤ì • ìŠ¤í‚¤ë§ˆ/ê¸°ë³¸ê°’/ë§ˆì´ê·¸ë ˆì´ì…˜/ensure
    â”‚   â”œâ”€ storage.js       # IndexedDB ê´€ë¦¬ (ì˜¤ë””ì˜¤/ì´ë¯¸ì§€ blob)
    â”‚   â”œâ”€ state.js         # ê³µìœ  ìƒíƒœ ê´€ë¦¬
    â”‚   â”œâ”€ utils.js         # ê³µìš© ìœ í‹¸ í•¨ìˆ˜
    â”‚   â”œâ”€ tags.js          # íƒœê·¸ ì •ê·œí™”/ì •ë ¬
    â”‚   â””â”€ engine.js        # ì˜¤ë””ì˜¤ ëŸ°íƒ€ì„ (ì¬ìƒ/ì •ì§€/í‹±/ì„ ê³¡/í‚¤ì›Œë“œíŒì •)
    â”‚
    â”œâ”€ [UI ëª¨ë“ˆ]
    â”‚   â”œâ”€ ui_floating.js       # í”Œë¡œíŒ… ë²„íŠ¼/ë©”ë‰´/ë“œë˜ê·¸
    â”‚   â”œâ”€ ui_nowplaying.js     # Now Playing UI/ê¸€ë¼ìŠ¤/seek
    â”‚   â”œâ”€ ui_modal.js          # ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°/fit/ê³µí†µ ìœ í‹¸
    â”‚   â”œâ”€ ui_settings_modal.js # ì„¤ì • ëª¨ë‹¬ ë©”ì¸ í—ˆë¸Œ (íƒ­ ì‹œìŠ¤í…œ)
    â”‚   â””â”€ ui_freesources.js    # Free Sources ëª¨ë‹¬/íƒœê·¸/ì¶”ê°€
    â”‚
    â”œâ”€ settings_modal/          # ì„¤ì • ëª¨ë‹¬ í•˜ìœ„ íŒ¨ë„ë“¤
    â”‚   â”œâ”€ preset.js            # í”„ë¦¬ì…‹ ê´€ë¦¬ (ì„ íƒ/ì¶”ê°€/ì‚­ì œ/import/export)
    â”‚   â”œâ”€ playlist.js          # BGM ëª©ë¡ í…Œì´ë¸” UI
    â”‚   â”œâ”€ modes.js             # Mode íƒ­ (Keyword/Time/SFX ëª¨ë“œ + TTS í˜¸ì¶œ)
    â”‚   â””â”€ tts.js               # TTS ì„¤ì • íŒ¨ë„ UI
    â”‚
    â””â”€ tts/                     # TTS ê¸°ëŠ¥
        â”œâ”€ tts_message_button.js  # AI ë©”ì‹œì§€ë³„ TTS ë²„íŠ¼
        â””â”€ providers/             # TTS API í”„ë¡œë°”ì´ë”ë“¤
            â”œâ”€ index.js           # í”„ë¡œë°”ì´ë” ë ˆì§€ìŠ¤íŠ¸ë¦¬
            â”œâ”€ qwen.js            # Qwen (Alibaba DashScope)
            â”œâ”€ openai.js          # OpenAI TTS
            â”œâ”€ gemini.js          # Google Gemini
            â”œâ”€ lmnt.js            # LMNT


[2] ëª¨ë“ˆ ì—­í•  ìƒì„¸
================================================================================

[2-A] ì½”ì–´ ëª¨ë“ˆ (DOM ì¡°ì‘ ê¸ˆì§€)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
deps.js (84ì¤„)
  - STì˜ extension_settings, saveSettingsDebounced, getContext ë“± resolve
  - ì„¤ì¹˜ ê²½ë¡œ ì°¨ì´ ëŒ€ì‘ (third-party vs ì¼ë°˜)

settings.js (633ì¤„)
  - ensureSettings(): ì„¤ì • ê°ì²´ ì´ˆê¸°í™”/ë³´ì •
  - ê¸°ë³¸ê°’ ìŠ¤í‚¤ë§ˆ ì •ì˜
  - ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œì§

storage.js (251ì¤„)
  - IndexedDB CRUD (idbGet, idbPut, idbDel)
  - ì˜¤ë””ì˜¤/ì´ë¯¸ì§€ blob ì €ì¥

state.js (187ì¤„)
  - ì „ì—­ ê³µìœ  ìƒíƒœ (ì¬ìƒ ìƒíƒœ, í˜„ì¬ íŠ¸ë™ ë“±)

utils.js (142ì¤„)
  - escapeHtml, uid, clone, preprocessForTts ë“± ìˆœìˆ˜ í•¨ìˆ˜

tags.js (282ì¤„)
  - íƒœê·¸ ì •ê·œí™”, ì •ë ¬, í‘œì‹œ ë¡œì§

engine.js (1070ì¤„)
  - ì˜¤ë””ì˜¤ ì¬ìƒ ëŸ°íƒ€ì„
  - í‚¤ì›Œë“œ ëª¨ë“œ íŒì •
  - ì‹œê°„ ëª¨ë“œ íŒì •
  - í‹± ë£¨í”„

[2-B] UI ëª¨ë“ˆ (í™”ë©´ë³„ ì „ë‹´)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ui_floating.js (384ì¤„)
  - í”Œë¡œíŒ… ë²„íŠ¼ ìƒì„±/ë“œë˜ê·¸/ìŠ¤ëƒ…
  - í”Œë¡œíŒ… ë©”ë‰´ ì—´ê¸°/ë‹«ê¸°

ui_nowplaying.js (976ì¤„)
  - Now Playing ë“œë¡œì–´ UI
  - ê¸€ë¼ìŠ¤ UI
  - Seek ë°”
  - ì•„ì´ì½˜ ë™ê¸°í™”

ui_modal.js (594ì¤„)
  - ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
  - í˜¸ìŠ¤íŠ¸ fit
  - ê³µí†µ ëª¨ë‹¬ ìœ í‹¸ (confirm, prompt ë“±)

ui_settings_modal.js (566ì¤„)
  - ì„¤ì • ëª¨ë‹¬ ë©”ì¸ í—ˆë¸Œ
  - íƒ­ ì‹œìŠ¤í…œ ê´€ë¦¬
  - ìì‹ ëª¨ë“ˆ ì¡°ë¦½ ë° ì˜ì¡´ì„± ì£¼ì…

ui_freesources.js (1567ì¤„)
  - Free Sources ëª¨ë‹¬
  - íƒœê·¸ í•„í„°ë§
  - ê³¡ ì¶”ê°€/ë™ê¸°í™”

[2-C] settings_modal/ (ì„¤ì • ëª¨ë‹¬ í•˜ìœ„ íŒ¨ë„)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
preset.js (359ì¤„)
  - í”„ë¦¬ì…‹ ì„ íƒ/ì¶”ê°€/ì‚­ì œ
  - ì´ë¦„ ë³€ê²½
  - Import/Export
  - ìºë¦­í„° ë°”ì¸ë”©

playlist.js (729ì¤„)
  - BGM ëª©ë¡ í…Œì´ë¸” ë Œë”ë§
  - ì •ë ¬/ê²€ìƒ‰
  - í•­ëª© ì¶”ê°€/ì‚­ì œ/í¸ì§‘

modes.js (490ì¤„)
  - Mode íƒ­ ì´ˆê¸°í™”
  - Keyword Mode íŒ¨ë„
  - Time Mode íŒ¨ë„
  - SFX Mode íŒ¨ë„
  - TTS Panel í˜¸ì¶œ (initTtsPanel)

tts.js (382ì¤„)
  - TTS ì„¤ì • íŒ¨ë„ UI
  - Provider ì„ íƒ/ì„¤ì •
  - í…ŒìŠ¤íŠ¸ ë²„íŠ¼
  - ë©”ì‹œì§€ ë²„íŠ¼ í† ê¸€ ì—°ë™

[2-D] tts/ (TTS ê¸°ëŠ¥)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
tts_message_button.js (340ì¤„)
  - AI ë©”ì‹œì§€ì— ğŸ”Š ë²„íŠ¼ ì‚½ì…
  - í´ë¦­ ì‹œ í•´ë‹¹ ë©”ì‹œì§€ TTS ì¬ìƒ
  - MutationObserverë¡œ ìƒˆ ë©”ì‹œì§€ ê°ì§€

providers/index.js (37ì¤„)
  - í”„ë¡œë°”ì´ë” ë ˆì§€ìŠ¤íŠ¸ë¦¬
  - getProvider(), getProviderList()

providers/qwen.js (98ì¤„)
  - Alibaba DashScope API
  - Qwen3-TTS ëª¨ë¸

providers/openai.js (84ì¤„)
  - OpenAI TTS API
  - tts-1, tts-1-hd ëª¨ë¸

providers/gemini.js (178ì¤„)
  - Google Gemini API
  - PCM â†’ WAV ë³€í™˜

providers/lmnt.js (151ì¤„)
  - LMNT API
  - JSON base64 ì‘ë‹µ ì²˜ë¦¬


[3] ì˜ì¡´ì„± ë°©í–¥ (ë‹¨ë°©í–¥ë§Œ í—ˆìš©)
================================================================================

ui_* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
settings_modal/* â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–¶ engine, settings, storage, state, utils, tags, deps
tts/tts_message_button â”˜

engine â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ state, settings, storage, utils, tags (ui_* í˜¸ì¶œ ê¸ˆì§€)

tts/providers/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ deps, utils (ui_*, engine í˜¸ì¶œ ê¸ˆì§€)

settings/storage/state/utils/tags/deps â”€â”€â–¶ ì„œë¡œ ìµœì†Œí•œìœ¼ë¡œë§Œ (ui_* import ê¸ˆì§€)

ìˆœí™˜ ì˜ì¡´ ê¸ˆì§€: A â†’ B â†’ A í˜•íƒœ ë¶ˆê°€


[4] í˜¸ì¶œ íë¦„
================================================================================

[í™•ì¥ ë¡œë“œ]
index.js (ST ì§„ì…ì )
  â””â”€â–¶ ì˜ì¡´ì„± resolve (deps.js)
  â””â”€â–¶ ì„¤ì • ì´ˆê¸°í™” (settings.js)
  â””â”€â–¶ UI ë°”ì¸ë”©

[ëª¨ë‹¬ ì—´ê¸°]
ui_modal.js: openModal()
  â””â”€â–¶ ui_settings_modal.js: initModal()
      â”œâ”€â–¶ preset.js: initPresetEvents()
      â”œâ”€â–¶ playlist.js: initPlaylistEvents()
      â””â”€â–¶ modes.js: initModePanel()
          â”œâ”€â–¶ Keyword/Time/SFX íŒ¨ë„ ì´ˆê¸°í™”
          â””â”€â–¶ tts.js: initTtsPanel()
              â””â”€â–¶ tts_message_button.js: updateSettingsRef()

[TTS ë©”ì‹œì§€ ë²„íŠ¼]
tts_message_button.js
  â”œâ”€â–¶ setMessageButtonsEnabled(true)
  â”‚   â”œâ”€â–¶ addTtsButtonsToAllMessages()
  â”‚   â””â”€â–¶ startMessageObserver()
  â””â”€â–¶ ë²„íŠ¼ í´ë¦­
      â””â”€â–¶ playTts()
          â””â”€â–¶ providers/index.js â†’ í•´ë‹¹ provider.getAudioUrl()


[5] íŒŒì¼ ìˆ˜ì • ê°€ì´ë“œ
================================================================================

"ì´ ê¸°ëŠ¥ ê³ ì¹˜ë ¤ë©´ ì´ íŒŒì¼ë§Œ ë³´ë©´ ë¨"

ê¸°ëŠ¥                          íŒŒì¼
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
í”Œë¡œíŒ… ë²„íŠ¼/ë©”ë‰´               ui_floating.js
Now Playing UI                ui_nowplaying.js
ì„¤ì • ëª¨ë‹¬ íƒ­/ê³µí†µ              ui_settings_modal.js
í”„ë¦¬ì…‹ ê´€ë¦¬                    settings_modal/preset.js
BGM ëª©ë¡ í…Œì´ë¸”                settings_modal/playlist.js
Keyword/Time/SFX ëª¨ë“œ          settings_modal/modes.js
TTS ì„¤ì • UI                    settings_modal/tts.js
TTS ë©”ì‹œì§€ ë²„íŠ¼                tts/tts_message_button.js
TTS í”„ë¡œë°”ì´ë” ì¶”ê°€            tts/providers/ìƒˆê±°.js + tts/providers/index.js
Free Sources                  ui_freesources.js
ì˜¤ë””ì˜¤ ì¬ìƒ ë¡œì§               engine.js
ì„¤ì • ìŠ¤í‚¤ë§ˆ/ê¸°ë³¸ê°’             settings.js
IndexedDB                     storage.js


[6] ê·œì¹™
================================================================================

[6-1] íŒŒì¼ í¬ê¸°
- ìµœì†Œ 200-400ì¤„, ìµœëŒ€ 1000ì¤„ ê¶Œì¥
- ë„ˆë¬´ ì‘ìœ¼ë©´ í•©ì¹˜ê³ , ë„ˆë¬´ í¬ë©´ ë¶„ë¦¬

[6-2] ê¸ˆì§€ì‚¬í•­
- ìˆœí™˜ ì˜ì¡´
- ì½”ì–´ ëª¨ë“ˆì—ì„œ DOM ì¡°ì‘
- engine.jsì—ì„œ ui_* í˜¸ì¶œ

[6-3] í—ˆìš©ì‚¬í•­
- import/export ì •ë¦¬
- íŒŒì¼ ë¶„ë¦¬/ì´ë™
- í•¨ìˆ˜/ìƒìˆ˜ ì´ë™
- ì£¼ì„ ì¶”ê°€
- ëª¨ë“ˆí™” ì‹œì—ëŠ” ê¸°ëŠ¥ ìˆ˜ì • ì—†ì´ íŒŒì¼ë§Œ ë¶„ë¦¬í•˜ëŠ” "ë¦¬íŒ©í† ë§"ë§Œ

================================================================================
